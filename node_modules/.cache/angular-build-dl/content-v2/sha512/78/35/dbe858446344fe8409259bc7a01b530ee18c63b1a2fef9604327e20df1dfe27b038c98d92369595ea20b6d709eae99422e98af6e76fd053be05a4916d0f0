function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_setPrototypeOf(e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function _createSuper(e){var t=_isNativeReflectConstruct();return function(){var r,n=_getPrototypeOf(e);if(t){var c=_getPrototypeOf(this).constructor;r=Reflect.construct(n,arguments,c)}else r=n.apply(this,arguments);return _possibleConstructorReturn(this,r)}}function _possibleConstructorReturn(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?_assertThisInitialized(e):t}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _slicedToArray(e,t){return _arrayWithHoles(e)||_iterableToArrayLimit(e,t)||_unsupportedIterableToArray(e,t)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _iterableToArrayLimit(e,t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e)){var r=[],n=!0,c=!1,o=void 0;try{for(var a,i=e[Symbol.iterator]();!(n=(a=i.next()).done)&&(r.push(a.value),!t||r.length!==t);n=!0);}catch(s){c=!0,o=s}finally{try{n||null==i.return||i.return()}finally{if(c)throw o}}return r}}function _arrayWithHoles(e){if(Array.isArray(e))return e}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function _createClass(e,t,r){return t&&_defineProperties(e.prototype,t),r&&_defineProperties(e,r),e}function _createForOfIteratorHelper(e,t){var r;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(r=_unsupportedIterableToArray(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,c=function(){};return{s:c,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:c}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,i=!1;return{s:function(){r=e[Symbol.iterator]()},n:function(){var e=r.next();return a=e.done,e},e:function(e){i=!0,o=e},f:function(){try{a||null==r.return||r.return()}finally{if(i)throw o}}}}function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_unsupportedIterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?_arrayLikeToArray(e,t):void 0}}function _iterableToArray(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e))return _arrayLikeToArray(e)}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}(window.webpackJsonp=window.webpackJsonp||[]).push([[5],{XJJU:function(e,t,r){"use strict";r.r(t),r.d(t,"CONTAINERS",(function(){return Fr})),r.d(t,"COMPONENTS",(function(){return Lr})),r.d(t,"MarketPlaceModule",(function(){return Kr}));var n={};r.r(n),r.d(n,"reset",(function(){return p})),r.d(n,"uploadImage",(function(){return m})),r.d(n,"uploadImageSuccess",(function(){return v})),r.d(n,"uploadImageFail",(function(){return y})),r.d(n,"downloadImage",(function(){return g})),r.d(n,"downloadImageSuccess",(function(){return O})),r.d(n,"downloadImageError",(function(){return C}));var c={};r.r(c),r.d(c,"createPurchaseContract",(function(){return x})),r.d(c,"createPurchaseContractSuccess",(function(){return U})),r.d(c,"loadProducts",(function(){return _})),r.d(c,"loadProductsSuccess",(function(){return B})),r.d(c,"loadPurchaseContract",(function(){return E})),r.d(c,"loadPurchaseContractSuccess",(function(){return $})),r.d(c,"removePurchaseContract",(function(){return R})),r.d(c,"removePurchaseContractSuccess",(function(){return F})),r.d(c,"abortSelectedPurchaseContract",(function(){return L})),r.d(c,"abortSelectedPurchaseContractSuccess",(function(){return K})),r.d(c,"confirmBuy",(function(){return M})),r.d(c,"confirmBuySuccess",(function(){return D})),r.d(c,"confirmDelivery",(function(){return N})),r.d(c,"confirmDeliverySuccess",(function(){return H})),r.d(c,"releaseEscrow",(function(){return q})),r.d(c,"releaseEscrowSuccess",(function(){return V})),r.d(c,"withdrawByOwner",(function(){return G})),r.d(c,"withdrawByOwnerSuccess",(function(){return Y}));var o=r("ofXK"),a=r("3Pt+"),i=r("M0ag"),s=r("tyNb"),u=r("mrSG"),l=r("0IaG"),f=r("vkgz"),b=r("5+qj"),d=r("kt0X"),h=r("Jt/G"),p=Object(d.o)("[IPFS/Image] Reset"),m=Object(d.o)("[IPFS/Image] Upload",Object(d.t)()),v=Object(d.o)("[IPFS/Image] Upload Success",Object(d.t)()),y=Object(d.o)("[IPFS/Image] Upload Fail"),g=Object(d.o)("[IPFS/Image] Download Image",Object(d.t)()),O=Object(d.o)("[IPFS/Image] Download Image Success",Object(d.t)()),C=Object(d.o)("[IPFS/Image] Download Image Error"),j=function(e){return e.Pending="Pending",e.Success="Success",e.Error="Error",e.Progress="Progress",e}({}),w={status:j.Pending,ipfsHash:null,imageBlob:null},P=Object(d.q)(w,Object(d.s)(p,(function(){return w})),Object(d.s)(m,(function(e){return Object.assign(Object.assign({},e),{status:j.Progress})})),Object(d.s)(v,(function(e,t){var r=t.ipfsHash;return Object.assign(Object.assign({},e),{status:j.Success,ipfsHash:r})})),Object(d.s)(y,(function(e){return Object.assign(Object.assign({},e),{status:j.Error,ipfsHash:null})})),Object(d.s)(O,(function(e,t){var r=t.image;return Object.assign(Object.assign({},e),{imageBlob:r})}))),T=r("fXoL"),I=function(){var e={EntitiesOnly:0,Both:1,None:2};return e[e.EntitiesOnly]="EntitiesOnly",e[e.Both]="Both",e[e.None]="None",e}();function k(e){return function(t,r){var n={ids:_toConsumableArray(r.ids),entities:Object.assign({},r.entities)},c=e(t,n);return c===I.Both?Object.assign({},r,n):c===I.EntitiesOnly?Object.assign(Object.assign({},r),{entities:n.entities}):r}}function S(e,t){var r=t(e);return Object(T.W)()&&void 0===r&&console.warn("@ngrx/entity: The entity passed to the `selectId` implementation returned undefined.","You should probably provide your own `selectId` implementation.","The entity that was passed:",e,"The `selectId` implementation:",t.toString()),r}function A(e){function t(t,r){var n=S(t,e);return n in r.entities?I.None:(r.ids.push(n),r.entities[n]=t,I.Both)}function r(e,r){var n,c=!1,o=_createForOfIteratorHelper(e);try{for(o.s();!(n=o.n()).done;){c=t(n.value,r)!==I.None||c}}catch(a){o.e(a)}finally{o.f()}return c?I.Both:I.None}function n(e,t){return t.ids=[],t.entities={},r(e,t),I.Both}function c(e,t){var r=(e instanceof Array?e:t.ids.filter((function(r){return e(t.entities[r])}))).filter((function(e){return e in t.entities})).map((function(e){return delete t.entities[e]})).length>0;return r&&(t.ids=t.ids.filter((function(e){return e in t.entities}))),r?I.Both:I.None}function o(t,r){var n={};return(t=t.filter((function(e){return e.id in r.entities}))).length>0?t.filter((function(t){return function(t,r,n){var c=Object.assign({},n.entities[r.id],r.changes),o=S(c,e),a=o!==r.id;return a&&(t[r.id]=o,delete n.entities[r.id]),n.entities[o]=c,a}(n,t,r)})).length>0?(r.ids=r.ids.map((function(e){return n[e]||e})),I.Both):I.EntitiesOnly:I.None}function a(t,n){var c,a=[],i=[],s=_createForOfIteratorHelper(t);try{for(s.s();!(c=s.n()).done;){var u=c.value,l=S(u,e);l in n.entities?i.push({id:l,changes:u}):a.push(u)}}catch(d){s.e(d)}finally{s.f()}var f=o(i,n),b=r(a,n);switch(!0){case b===I.None&&f===I.None:return I.None;case b===I.Both||f===I.Both:return I.Both;default:return I.EntitiesOnly}}return{removeAll:function(e){return Object.assign({},e,{ids:[],entities:{}})},addOne:k(t),addMany:k(r),addAll:k(n),setAll:k(n),setOne:k((function(t,r){var n=S(t,e);return n in r.entities?(r.entities[n]=t,I.EntitiesOnly):(r.ids.push(n),r.entities[n]=t,I.Both)})),updateOne:k((function(e,t){return o([e],t)})),updateMany:k(o),upsertOne:k((function(e,t){return a([e],t)})),upsertMany:k(a),removeOne:k((function(e,t){return c([e],t)})),removeMany:k(c),map:k((function(e,t){return o(t.ids.reduce((function(r,n){var c=e(t.entities[n]);return c!==t.entities[n]&&r.push({id:n,changes:c}),r}),[]).filter((function(e){return e.id in t.entities})),t)}))}}var x=Object(d.o)("[PurchaseContract/API] Create Purchase Contract",Object(d.t)()),U=Object(d.o)("[PurchaseContract/Command] Create Purchase Contract Success",Object(d.t)()),_=Object(d.o)("[Product/API] Load Products"),B=Object(d.o)("[Product/Command] Load Products Success",Object(d.t)()),E=Object(d.o)("[PurchaseContract/API] Load Purchase Contract",Object(d.t)()),$=Object(d.o)("[PurchaseContract/Command] Load Purchase Contract Success",Object(d.t)()),R=Object(d.o)("[PurchaseContract/API] Remove Purchase Contract",Object(d.t)()),F=Object(d.o)("[PurchaseContract/Command] Remove Purchase Contract Success",Object(d.t)()),L=Object(d.o)("[PurchaseContract/API] Abort Purchase Contract"),K=Object(d.o)("[PurchaseContract/Command] Abort Purchase Contract Success"),M=Object(d.o)("[PurchaseContract/API] Confirm Buy",Object(d.t)()),D=Object(d.o)("[PurchaseContract/Command] Confirm Buy Success"),N=Object(d.o)("[PurchaseContract/API] Confirm Product Delivery"),H=Object(d.o)("[PurchaseContract/Command] Confirm Product Delivery Success"),q=Object(d.o)("[PurchaseContract/API] Withdraw Escrow By Seller"),V=Object(d.o)("[PurchaseContract/Command] Withdraw Escrow By Seller Success",Object(d.t)()),G=Object(d.o)("[PurchaseContract/API] Withdraw By Owner"),Y=Object(d.o)("[PurchaseContract/Command] Withdraw By Owner Success",Object(d.t)()),W=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Object.assign({sortComparer:!1,selectId:function(e){return e.id}},e),r=t.selectId,n=t.sortComparer,c={getInitialState:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object.assign({ids:[],entities:{}},e)}},o={getSelectors:function(e){var t=function(e){return e.ids},r=function(e){return e.entities},n=Object(d.r)(t,r,(function(e,t){return e.map((function(e){return t[e]}))})),c=Object(d.r)(t,(function(e){return e.length}));return e?{selectIds:Object(d.r)(e,t),selectEntities:Object(d.r)(e,r),selectAll:Object(d.r)(e,n),selectTotal:Object(d.r)(e,c)}:{selectIds:t,selectEntities:r,selectAll:n,selectTotal:c}}},a=n?function(e,t){var r=A(e);function n(e,t){return c([e],t)}function c(t,r){var n=t.filter((function(t){return!(S(t,e)in r.entities)}));return 0===n.length?I.None:(s(n,r),I.Both)}function o(e,t){return t.entities={},t.ids=[],c(e,t),I.Both}function a(t,r){var n=[],c=t.filter((function(t){return function(t,r,n){if(!(r.id in n.entities))return!1;var c=Object.assign({},n.entities[r.id],r.changes),o=S(c,e);return delete n.entities[r.id],t.push(c),o!==r.id}(n,t,r)})).length>0;if(0===n.length)return I.None;var o=r.ids,a=[];return r.ids=r.ids.filter((function(e,t){return e in r.entities||(a.push(t),!1)})),s(n,r),!c&&a.every((function(e){return r.ids[e]===o[e]}))?I.EntitiesOnly:I.Both}function i(t,r){var n,o=[],i=[],s=_createForOfIteratorHelper(t);try{for(s.s();!(n=s.n()).done;){var u=n.value,l=S(u,e);l in r.entities?i.push({id:l,changes:u}):o.push(u)}}catch(d){s.e(d)}finally{s.f()}var f=a(i,r),b=c(o,r);switch(!0){case b===I.None&&f===I.None:return I.None;case b===I.Both||f===I.Both:return I.Both;default:return I.EntitiesOnly}}function s(r,n){r.sort(t);for(var c=[],o=0,a=0;o<r.length&&a<n.ids.length;){var i=r[o],s=S(i,e),u=n.ids[a];t(i,n.entities[u])<=0?(c.push(s),o++):(c.push(u),a++)}n.ids=c.concat(o<r.length?r.slice(o).map(e):n.ids.slice(a)),r.forEach((function(t,r){n.entities[e(t)]=t}))}return{removeOne:r.removeOne,removeMany:r.removeMany,removeAll:r.removeAll,addOne:k(n),updateOne:k((function(e,t){return a([e],t)})),upsertOne:k((function(e,t){return i([e],t)})),addAll:k(o),setAll:k(o),setOne:k((function(t,r){var c=S(t,e);return c in r.entities?(r.ids=r.ids.filter((function(e){return e!==c})),s([t],r),I.Both):n(t,r)})),addMany:k(c),updateMany:k(a),upsertMany:k(i),map:k((function(e,t){return a(t.ids.reduce((function(r,n){var c=e(t.entities[n]);return c!==t.entities[n]&&r.push({id:n,changes:c}),r}),[]),t)}))}}(r,n):A(r);return Object.assign(Object.assign(Object.assign({selectId:r,sortComparer:n},c),o),a)}({selectId:function(e){return e.productKey},sortComparer:function(e,t){return e.productKey.localeCompare(t.productKey)}}),X=W.getInitialState({loaded:!1,selectedPurchaseContract:null}),Q=Object(d.q)(X,Object(d.s)(c.loadProductsSuccess,(function(e,t){var r=t.products;return W.setAll(r,Object.assign(Object.assign({},e),{loaded:!0,selectedPurchaseContract:null}))})),Object(d.s)(c.removePurchaseContractSuccess,(function(e,t){var r=t.key;return W.removeOne(r,Object.assign(Object.assign({},e),{selectedPurchaseContract:null}))})),Object(d.s)(c.createPurchaseContractSuccess,(function(e,t){var r=t.product;return W.addOne(r,e)})),Object(d.s)(c.loadPurchaseContractSuccess,(function(e,t){var r=t.contract;return Object.assign(Object.assign({},e),{selectedPurchaseContract:r})})));function z(e,t){return Object(d.m)({ipfs:P,products:Q})(e,t)}var J=Object(d.p)("purchaseContract"),Z=Object(d.r)(J,(function(e){return e.ipfs})),ee=Object(d.r)(Z,(function(e){return e.status})),te=Object(d.r)(Z,(function(e){return e.ipfsHash})),re=Object(d.r)(Z,(function(e){return e.imageBlob})),ne=Object(d.r)(J,(function(e){return e.products})),ce=W.getSelectors(ne),oe=ce.selectEntities,ae=ce.selectAll,ie=Object(d.r)(ne,(function(e){return e.loaded})),se=Object(d.r)(ne,(function(e){return e.selectedPurchaseContract})),ue=Object(d.r)(oe,h.j,(function(e,t){return t&&e[t.id]})),le=r("659L"),fe=r("zp1y"),be=r("lJxs"),de=r("pLZG"),he=r("IzEk"),pe=r("bTqV"),me=r("Xa2L"),ve=["ipfsImage"];function ye(e,t){1&e&&T.Pb(0,"div")}function ge(e,t){1&e&&T.Pb(0,"mat-progress-spinner",7)}var Oe,Ce=((Oe=function(){function e(t,r,n){_classCallCheck(this,e),this.store$=t,this.dialogRef=r,this.windowRef=n}return _createClass(e,[{key:"ngOnInit",value:function(){var e=this;this.image$=this.checkStore().pipe(Object(f.a)((function(t){return e.imageRef.nativeElement.src=e.windowRef.window.URL.createObjectURL(t)})))}},{key:"checkStore",value:function(){var e=this;return this.store$.pipe(Object(d.u)(re),Object(fe.a)(this.store$.pipe(Object(d.u)(te))),Object(f.a)((function(t){var r=_slicedToArray(t,2),n=r[0],c=r[1];n||e.store$.dispatch(g({ipfsHash:c}))})),Object(be.a)((function(e){var t=_slicedToArray(e,2),r=t[0];return t[1],r})),Object(de.a)((function(e){return!!e})),Object(he.a)(1))}}]),e}()).\u0275fac=function(e){return new(e||Oe)(T.Ob(d.h),T.Ob(l.h),T.Ob(le.c))},Oe.\u0275cmp=T.Ib({type:Oe,selectors:[["app-show-ipfs-image"]],viewQuery:function(e,t){var r;1&e&&T.yc(ve,!0),2&e&&T.rc(r=T.dc())&&(t.imageRef=r.first)},decls:12,vars:5,consts:[["mat-dialog-title",""],[4,"ngIf","ngIfElse"],[1,"text-center"],["height","300px","width","300px"],["ipfsImage",""],["loading",""],["mat-stroked-button","","color","warn","cdkFocusInitial","",3,"mat-dialog-close"],["color","warn","mode","indeterminate","value","50","diameter","100","strokeWidth","10"]],template:function(e,t){if(1&e&&(T.Ub(0,"h2",0),T.Cc(1,"IPFS Product Image"),T.Tb(),T.Ac(2,ye,1,0,"div",1),T.hc(3,"async"),T.Ub(4,"mat-dialog-content",2),T.Pb(5,"img",3,4),T.Ac(7,ge,1,0,"ng-template",null,5,T.Bc),T.Tb(),T.Ub(9,"mat-dialog-actions"),T.Ub(10,"button",6),T.Cc(11,"OK"),T.Tb(),T.Tb()),2&e){var r=T.sc(8);T.Cb(2),T.lc("ngIf",T.ic(3,3,t.image$))("ngIfElse",r),T.Cb(8),T.lc("mat-dialog-close",!0)}},directives:[l.i,o.k,l.f,l.c,pe.b,l.d,me.a],pipes:[o.b],styles:[""],changeDetection:0}),Oe),je=r("A5z7"),we=r("XiUz"),Pe=r("Wp6s"),Te=r("kmnG"),Ie=r("qFsG"),ke=r("d3UM"),Se=r("NFeN"),Ae=r("FKr1"),xe=r("Qu3c"),Ue=["file"];function _e(e,t){1&e&&(T.Ub(0,"mat-error"),T.Cc(1,"Value is required"),T.Tb())}function Be(e,t){1&e&&(T.Ub(0,"mat-error"),T.Cc(1," Invalid product key string. Must be less than 32 bytes"),T.Tb())}function Ee(e,t){1&e&&(T.Ub(0,"mat-error"),T.Cc(1,"Value is required"),T.Tb())}function $e(e,t){1&e&&(T.Ub(0,"mat-error"),T.Cc(1,"Value is required"),T.Tb())}function Re(e,t){1&e&&(T.Ub(0,"mat-error"),T.Cc(1,"Invalid ether value format. Has to be (#.###)"),T.Tb())}function Fe(e,t){if(1&e&&(T.Ub(0,"mat-option",23),T.Cc(1),T.Tb()),2&e){var r=t.$implicit;T.lc("value",r),T.Cb(1),T.Ec(" ",r," ")}}function Le(e,t){1&e&&(T.Ub(0,"mat-error"),T.Cc(1,"Value is required"),T.Tb())}function Ke(e,t){if(1&e){var r=T.Vb();T.Ub(0,"button",24),T.cc("click",(function(){return T.uc(r),T.gc().uploadFile()})),T.Cc(1," Upload To IPFS "),T.Ub(2,"mat-icon"),T.Cc(3,"offline_bolt"),T.Tb(),T.Tb()}if(2&e){var n=T.gc();T.lc("disabled",n.formControl("fileArg").invalid)}}function Me(e,t){1&e&&T.Qb(0)}function De(e,t){1&e&&(T.Ub(0,"mat-error",34),T.Cc(1,"You must choose a file"),T.Tb())}function Ne(e,t){1&e&&(T.Ub(0,"mat-error",34),T.Cc(1,"Invalid file image extension"),T.Tb())}function He(e,t){if(1&e&&(T.Ub(0,"div",25),T.Ac(1,De,2,0,"mat-error",33),T.Ac(2,Ne,2,0,"mat-error",33),T.Tb()),2&e){var r=T.gc(2);T.Cb(1),T.lc("ngIf",r.requiredFile("fileArg")),T.Cb(1),T.lc("ngIf",r.invalidPatternFile("fileArg"))}}function qe(e,t){if(1&e&&(T.Ub(0,"div",25),T.Pb(1,"img",35),T.Ub(2,"p"),T.Cc(3),T.Tb(),T.Tb()),2&e){var r=T.gc(2);T.Cb(1),T.lc("src",r.fileContent,T.vc),T.Cb(2),T.Ec(" ",r.fileBlob.name," ")}}function Ve(e,t){if(1&e){var r=T.Vb();T.Ub(0,"div",36),T.Ub(1,"button",37),T.cc("click",(function(){return T.uc(r),T.gc(2).loadImage()})),T.Cc(2),T.Ub(3,"mat-icon"),T.Cc(4,"visibility"),T.Tb(),T.Tb(),T.Tb()}if(2&e){var n=t.ngIf;T.Cb(2),T.Ec(" ",n," ")}}function Ge(e,t){1&e&&(T.Ub(0,"div"),T.Pb(1,"mat-progress-spinner",40),T.Tb())}function Ye(e,t){if(1&e&&(T.Ub(0,"mat-chip"),T.Cc(1),T.Tb()),2&e){var r=T.gc(2).ngIf;T.Cb(1),T.Dc(r)}}function We(e,t){if(1&e&&(T.Ub(0,"mat-chip",43),T.Cc(1),T.Tb()),2&e){var r=T.gc(2).ngIf;T.Cb(1),T.Ec(" ",r," ")}}function Xe(e,t){if(1&e&&(T.Ub(0,"mat-chip",44),T.Cc(1),T.Tb()),2&e){var r=T.gc(2).ngIf;T.Cb(1),T.Ec(" ",r," ")}}function Qe(e,t){if(1&e&&(T.Ac(0,Ye,2,1,"mat-chip",9),T.Ac(1,We,2,1,"mat-chip",41),T.Ac(2,Xe,2,1,"mat-chip",42)),2&e){var r=T.gc().ngIf,n=T.gc(2);T.lc("ngIf",n.isPending(r)),T.Cb(1),T.lc("ngIf",n.isSuccess(r)),T.Cb(1),T.lc("ngIf",n.isError(r))}}function ze(e,t){if(1&e&&(T.Ub(0,"div"),T.Ac(1,Ge,2,0,"div",38),T.Ac(2,Qe,3,3,"ng-template",null,39,T.Bc),T.Tb()),2&e){var r=t.ngIf,n=T.sc(3),c=T.gc(2);T.Cb(1),T.lc("ngIf",c.inProgress(r))("ngIfElse",n)}}function Je(e,t){if(1&e&&(T.Ub(0,"mat-card-content"),T.Ub(1,"div",6),T.Ub(2,"div",25),T.Cc(3,"Image"),T.Tb(),T.Ub(4,"div",26),T.Cc(5,"IPFS Hash"),T.Tb(),T.Ub(6,"div",27),T.Cc(7,"Upload Status"),T.Tb(),T.Tb(),T.Pb(8,"p"),T.Ub(9,"div",6),T.Ac(10,Me,1,0,"ng-container",28),T.Ac(11,He,3,2,"ng-template",null,29,T.Bc),T.Ac(13,qe,4,2,"ng-template",null,30,T.Bc),T.Ub(15,"div",31),T.Ac(16,Ve,5,1,"div",32),T.hc(17,"async"),T.Tb(),T.Ub(18,"div",27),T.Ac(19,ze,4,2,"div",9),T.hc(20,"async"),T.Tb(),T.Tb(),T.Tb()),2&e){var r=T.sc(12),n=T.sc(14),c=T.gc();T.Cb(10),T.lc("ngIf",c.formControl("fileArg").invalid)("ngIfThen",r)("ngIfElse",n),T.Cb(6),T.lc("ngIf",T.ic(17,5,c.ipfsHash$)),T.Cb(3),T.lc("ngIf",T.ic(20,7,c.uploadStatus$))}}function Ze(e){var t=!1;try{b.utils.formatBytes32String(e.value),t=!0}catch(r){}return t?null:{forbiddenKey:{value:e.value}}}var et,tt=((et=function(){function e(t,r,n){var c=this;_classCallCheck(this,e),this.store$=t,this.formBuilder=r,this.dialog=n,this.IMAGE_PATTERN=/^.+\.(png|jpg|jpeg|gif|png)$/,this.commissions=["1.0","2.0","3.0","4.0","5.0"],this.frmGroup=this.formBuilder.group({productKey:["",[a.p.required,Ze]],description:["",a.p.required],etherValue:["",[a.p.required,a.p.pattern(/^\d+(\.\d{1,3})?$/)]],commission:["",a.p.required],fileArg:["",[a.p.required,a.p.pattern(this.IMAGE_PATTERN)]],ipfsHash:["",a.p.required]}),this.formControl=function(e){return c.frmGroup.get(""+e)},this.required=function(e){return c.formControl(e).hasError("required")&&c.formControl(e).touched},this.invalidPattern=function(e){return c.formControl(e).hasError("pattern")&&c.formControl(e).dirty},this.invalid32BytesKey=function(e){return c.formControl(e).hasError("forbiddenKey")&&c.formControl(e).dirty},this.requiredFile=function(e){return c.formControl(e).hasError("required")},this.invalidPatternFile=function(e){return c.formControl(e).hasError("pattern")},this.isPending=function(e){return e===j.Pending},this.isSuccess=function(e){return e===j.Success},this.isError=function(e){return e===j.Error},this.inProgress=function(e){return e===j.Progress}}return _createClass(e,[{key:"ngOnInit",value:function(){var e=this;this.uploadStatus$=this.store$.pipe(Object(d.u)(ee)),this.ipfsHash$=this.store$.pipe(Object(d.u)(te),Object(f.a)((function(t){return e.frmGroup.get("ipfsHash").patchValue(t)})))}},{key:"selectFile",value:function(){this.fileControl.nativeElement.click()}},{key:"onFileChange",value:function(e){var t=this;if(e.target.files&&e.target.files.length){this.fileBlob=e.target.files[0],this.frmGroup.get("fileArg").patchValue(this.fileBlob.name);var r=new FileReader;r.readAsDataURL(this.fileBlob),r.onload=function(e){t.fileContent=r.result,t.store$.dispatch(n.reset())}}}},{key:"uploadFile",value:function(){this.store$.dispatch(n.uploadImage({file:this.fileBlob}))}},{key:"loadImage",value:function(){var e=new l.e;e.width="460px",e.disableClose=!0,e.autoFocus=!0,this.dialog.open(Ce,e)}},{key:"onCreate",value:function(){if(this.frmGroup.valid){var e=this.frmGroup.value,t=Object(u.c)(e,["fileArg"]);this.store$.dispatch(c.createPurchaseContract({payload:t}))}}},{key:"ngOnDestroy",value:function(){this.store$.dispatch(n.reset())}}]),e}()).\u0275fac=function(e){return new(e||et)(T.Ob(d.h),T.Ob(a.c),T.Ob(l.b))},et.\u0275cmp=T.Ib({type:et,selectors:[["app-new-purchase-contract"]],viewQuery:function(e,t){var r;1&e&&T.Gc(Ue,!0),2&e&&T.rc(r=T.dc())&&(t.fileControl=r.first)},decls:45,vars:15,consts:[["fxLayout","row","fxLayoutAlign","center start"],["fxFlex","60"],["novalidate","",3,"formGroup"],["fxLayout","row","fxLayoutGap","6px"],[1,"red-color"],[1,"mat-caption","text-muted"],["fxLayout","row","fxLayoutAlign","start center"],["fxFlex","",3,"color"],["matInput","","placeholder","Unique Product Key *","formControlName","productKey"],[4,"ngIf"],["matInput","","placeholder","Description *","formControlName","description"],["fxFlex","45",3,"color"],["matInput","","placeholder","Value in ether. Has to include 2x price *","formControlName","etherValue"],["matSuffix",""],["fxFlex","45","fxFlexOffset","40px",3,"color"],["placeholder","Quantity *","formControlName","commission"],[3,"value",4,"ngFor","ngForOf"],["type","file",2,"display","none",3,"change"],["file",""],["mat-raised-button","","color","primary",3,"click"],["mat-raised-button","","color","accent",3,"disabled","click",4,"ngIf"],["fxLayout","row","fxLayoutAlign","end center"],["mat-flat-button","","color","warn",1,"margin-right--10",3,"disabled","click"],[3,"value"],["mat-raised-button","","color","accent",3,"disabled","click"],["fxFlex","25",1,"text-center"],["fxFlex","",1,"text-center"],["fxFlex","15",1,"text-center"],[4,"ngIf","ngIfThen","ngIfElse"],["showError",""],["showImage",""],["fxFlex",""],["class","text-center",4,"ngIf"],["mat-line","",4,"ngIf"],["mat-line",""],["height","200","width","200",3,"src"],[1,"text-center"],["mat-stroked-button","","color","warn","matTooltip","Click to show image from IPFS",3,"click"],[4,"ngIf","ngIfElse"],["idle",""],["color","warn","mode","indeterminate","value","50","diameter","50","strokeWidth","5"],["selected","true","color","accent",4,"ngIf"],["selected","true","color","warn",4,"ngIf"],["selected","true","color","accent"],["selected","true","color","warn"]],template:function(e,t){1&e&&(T.Pb(0,"mat-chip-list"),T.Ub(1,"div",0),T.Ub(2,"mat-card",1),T.Ub(3,"mat-card-subtitle"),T.Cc(4," Add Inventory "),T.Tb(),T.Ub(5,"form",2),T.Ub(6,"mat-card-content"),T.Ub(7,"div",3),T.Ub(8,"span",4),T.Cc(9,"*"),T.Tb(),T.Ub(10,"div",5),T.Cc(11,"required fields"),T.Tb(),T.Tb(),T.Ub(12,"div",6),T.Ub(13,"mat-form-field",7),T.Pb(14,"input",8),T.Ac(15,_e,2,0,"mat-error",9),T.Ac(16,Be,2,0,"mat-error",9),T.Tb(),T.Tb(),T.Ub(17,"div",6),T.Ub(18,"mat-form-field",7),T.Pb(19,"input",10),T.Ac(20,Ee,2,0,"mat-error",9),T.Tb(),T.Tb(),T.Ub(21,"div",6),T.Ub(22,"mat-form-field",11),T.Pb(23,"input",12),T.Ub(24,"span",13),T.Cc(25,"$ETH"),T.Tb(),T.Ac(26,$e,2,0,"mat-error",9),T.Ac(27,Re,2,0,"mat-error",9),T.Tb(),T.Ub(28,"mat-form-field",14),T.Ub(29,"mat-select",15),T.Ac(30,Fe,2,2,"mat-option",16),T.Tb(),T.Pb(31,"span",13),T.Ac(32,Le,2,0,"mat-error",9),T.Tb(),T.Tb(),T.Tb(),T.Ub(33,"input",17,18),T.cc("change",(function(e){return t.onFileChange(e)})),T.Tb(),T.Ub(35,"mat-card-actions"),T.Ub(36,"button",19),T.cc("click",(function(){return t.selectFile()})),T.Cc(37," Product Image "),T.Ub(38,"mat-icon"),T.Cc(39,"category"),T.Tb(),T.Tb(),T.Ac(40,Ke,4,1,"button",20),T.Tb(),T.Ac(41,Je,21,9,"mat-card-content",9),T.Ub(42,"mat-card-actions",21),T.Ub(43,"button",22),T.cc("click",(function(){return t.onCreate()})),T.Cc(44,"Add Product"),T.Tb(),T.Tb(),T.Tb(),T.Tb(),T.Tb()),2&e&&(T.Cb(5),T.lc("formGroup",t.frmGroup),T.Cb(8),T.lc("color","accent"),T.Cb(2),T.lc("ngIf",t.required("productKey")),T.Cb(1),T.lc("ngIf",t.invalid32BytesKey("productKey")),T.Cb(2),T.lc("color","accent"),T.Cb(2),T.lc("ngIf",t.required("description")),T.Cb(2),T.lc("color","accent"),T.Cb(4),T.lc("ngIf",t.required("etherValue")),T.Cb(1),T.lc("ngIf",t.invalidPattern("etherValue")),T.Cb(1),T.lc("color","accent"),T.Cb(2),T.lc("ngForOf",t.commissions),T.Cb(2),T.lc("ngIf",t.required("description")),T.Cb(8),T.lc("ngIf",t.fileBlob),T.Cb(1),T.lc("ngIf",t.fileBlob),T.Cb(2),T.lc("disabled",t.frmGroup.pristine||t.frmGroup.invalid))},directives:[je.b,we.d,we.c,Pe.a,we.a,Pe.f,a.q,a.l,a.g,Pe.c,we.e,Te.c,Ie.b,a.b,a.k,a.f,o.k,Te.h,we.b,ke.a,o.j,Pe.b,pe.b,Se.a,Te.b,Ae.n,Ae.j,xe.a,me.a,je.a],pipes:[o.b],styles:[".spiner-section-200[_ngcontent-%COMP%]{width:200px}.margin-right--10[_ngcontent-%COMP%]{margin-right:10px!important}"]}),et),rt=r("xgIS"),nt=r("itXk"),ct=r("JX91"),ot=r("Kj3r"),at=r("/uUt"),it=r("MutI"),st=r("f0Cb");function ut(e,t){if(1&e){var r=T.Vb();T.Ub(0,"mat-list-item",1),T.cc("click",(function(){T.uc(r);var e=t.$implicit;return T.gc().selectMe.emit(e)})),T.Pb(1,"img",2),T.Ub(2,"h3",3),T.Cc(3),T.Tb(),T.Pb(4,"mat-divider"),T.Tb()}if(2&e){var n=t.$implicit;T.Cb(3),T.Dc(n.productKey)}}var lt,ft=((lt=function e(){_classCallCheck(this,e),this.selectMe=new T.o}).\u0275fac=function(e){return new(e||lt)},lt.\u0275cmp=T.Ib({type:lt,selectors:[["app-purchase-contract-list"]],inputs:{products:"products"},outputs:{selectMe:"selectMe"},decls:2,vars:1,consts:[[3,"click",4,"ngFor","ngForOf"],[3,"click"],["matListAvatar","","src","../../../../assets/img/purchase-contract.png"],["mat-line","",1,"mat-h3"]],template:function(e,t){1&e&&(T.Ub(0,"mat-list"),T.Ac(1,ut,5,1,"mat-list-item",0),T.Tb()),2&e&&(T.Cb(1),T.lc("ngForOf",t.products))},directives:[it.a,o.j,it.c,it.b,Ae.j,st.a],styles:["mat-list[_ngcontent-%COMP%] {\n      position: relative;\n      max-height: 420px;\n      overflow: auto;\n      }","mat-list-item[_ngcontent-%COMP%] {\n      cursor: pointer;\n      }\n\n    mat-list-item[_ngcontent-%COMP%]:hover {\n      box-shadow: 3px 3px 12px -2px rgba(0, 0, 0, 0.5);\n    }"]}),lt),bt=["contractKey"];function dt(e,t){1&e&&(T.Ub(0,"p"),T.Cc(1," No Products to Show "),T.Tb())}var ht,pt=((ht=function(){function e(t,r){_classCallCheck(this,e),this.store$=t,this.router=r}return _createClass(e,[{key:"ngAfterViewInit",value:function(){var e=this,t=this.store$.pipe(Object(d.u)(ae)),r=Object(rt.a)(this.contractKey.nativeElement,"keyup").pipe(Object(be.a)((function(t){return e.contractKey.nativeElement.value})),Object(ct.a)(""),Object(ot.a)(150),Object(at.a)());this.filteredProducts$=Object(nt.a)([t,r]).pipe(Object(be.a)((function(e){var t=_slicedToArray(e,2),r=t[0],n=t[1];return r.filter((function(e){return-1!==e.productKey.indexOf(n)}))}))),setTimeout((function(){e.contractKey.nativeElement.focus()}),150)}},{key:"selectPurchaseContract",value:function(e){this.router.navigate(["market-place/products",e.productKey])}},{key:"ngOnInit",value:function(){}}]),e}()).\u0275fac=function(e){return new(e||ht)(T.Ob(d.h),T.Ob(s.f))},ht.\u0275cmp=T.Ib({type:ht,selectors:[["app-view-product-collection"]],viewQuery:function(e,t){var r;1&e&&T.Gc(bt,!0),2&e&&T.rc(r=T.dc())&&(t.contractKey=r.first)},decls:21,vars:6,consts:[["fxLayout","row","fxLayoutAlign","center stretch","fxLayoutGap","16px"],["fxFlex","50"],["fxLayout","row","fxLayoutAlign","space-between center"],["color","accent","fxFlex","40"],["matInput","","placeholder","Search for contact by key"],["contractKey",""],["mat-mini-fab","","color","warn","routerLink","./make/new","matTooltip","create new contract","matTooltipPosition","left",2,"margin-right","20px"],[3,"products","selectMe"],[4,"ngIf"]],template:function(e,t){if(1&e&&(T.Ub(0,"div",0),T.Ub(1,"mat-card",1),T.Ub(2,"mat-card-subtitle"),T.Cc(3,"Inventory List"),T.Tb(),T.Ub(4,"mat-card-content",2),T.Ub(5,"mat-form-field",3),T.Pb(6,"input",4,5),T.Tb(),T.Ub(8,"div"),T.Ub(9,"a",6),T.Ub(10,"mat-icon"),T.Cc(11,"Add"),T.Tb(),T.Tb(),T.Tb(),T.Tb(),T.Ub(12,"mat-card-content"),T.Ub(13,"app-purchase-contract-list",7),T.cc("selectMe",(function(e){return t.selectPurchaseContract(e)})),T.hc(14,"async"),T.Tb(),T.Ac(15,dt,2,0,"p",8),T.hc(16,"async"),T.Tb(),T.Tb(),T.Ub(17,"mat-card",1),T.Ub(18,"mat-card-subtitle"),T.Cc(19,"Product Details"),T.Tb(),T.Pb(20,"router-outlet"),T.Tb(),T.Tb()),2&e){var r,n=0===(null==(r=T.ic(16,4,t.filteredProducts$))?null:r.length);T.Cb(13),T.lc("products",T.ic(14,2,t.filteredProducts$)),T.Cb(2),T.lc("ngIf",n)}},directives:[we.d,we.c,we.e,Pe.a,we.a,Pe.f,Pe.c,Te.c,Ie.b,pe.a,s.i,xe.a,Se.a,ft,o.k,s.k],pipes:[o.b],encapsulation:2,changeDetection:0}),ht),mt=r("eIep"),vt=r("XNiG"),yt=function(e){return e[e.Created=0]="Created",e[e.Locked=1]="Locked",e[e.Canceled=2]="Canceled",e[e.ItemReceived=3]="ItemReceived",e[e.SellerPaid=4]="SellerPaid",e[e.OwnerPaid=5]="OwnerPaid",e[e.Completed=6]="Completed",e}({}),gt=["ipfsImage"];function Ot(e,t){1&e&&T.Qb(0)}function Ct(e,t){if(1&e&&(T.Ub(0,"mat-list-item"),T.Ub(1,"h3",10),T.Cc(2,"Buyer Address"),T.Tb(),T.Ub(3,"span"),T.Cc(4),T.Tb(),T.Tb()),2&e){var r=T.gc(2);T.Cb(4),T.Dc(r.contract.buyerAddress)}}function jt(e,t){if(1&e&&(T.Ub(0,"mat-list-item"),T.Ub(1,"h3",10),T.Cc(2,"Quantity"),T.Tb(),T.Ub(3,"span"),T.Cc(4),T.Tb(),T.Tb()),2&e){var r=T.gc(2);T.Cb(4),T.Dc(r.contract.commission/100)}}function wt(e,t){if(1&e&&(T.Ub(0,"mat-error"),T.Cc(1),T.Tb()),2&e){var r=T.gc(3);T.Cb(1),T.Dc(r.validatorError)}}function Pt(e,t){if(1&e&&(T.Ub(0,"mat-form-field",21),T.Ub(1,"mat-label"),T.Cc(2,"Value in ETH. (2X price)"),T.Tb(),T.Pb(3,"input",22),T.Ac(4,wt,2,1,"mat-error",11),T.Ub(5,"mat-icon",23),T.Cc(6,"sentiment_very_satisfied"),T.Tb(),T.Ub(7,"mat-hint"),T.Cc(8,"Producer Confirm Purchase"),T.Tb(),T.Tb()),2&e){var r=T.gc(2);T.Cb(3),T.lc("formControl",r.buyerConfirmPrice),T.Cb(1),T.lc("ngIf",r.buyerConfirmPrice.invalid&&r.buyerConfirmPrice.touched)}}function Tt(e,t){if(1&e){var r=T.Vb();T.Ub(0,"button",24),T.cc("click",(function(){T.uc(r);var e=T.gc(2);return e.buy.emit(e.buyerConfirmPrice.value)})),T.Cc(1," Producer Execute Purchase"),T.Tb()}if(2&e){var n=T.gc(2);T.lc("disabled",!(n.buyerConfirmPrice.valid&&n.buyerConfirmPrice.dirty))}}function It(e,t){if(1&e){var r=T.Vb();T.Ub(0,"button",25),T.cc("click",(function(){return T.uc(r),T.gc(2).delivery.emit()})),T.Cc(1," Supplier Confirm Delivery"),T.Tb()}}function kt(e,t){if(1&e){var r=T.Vb();T.Ub(0,"button",26),T.cc("click",(function(){return T.uc(r),T.gc(2).releaseEscrow.emit()})),T.Cc(1," Supplier Receive Escrow "),T.Ub(2,"mat-icon"),T.Cc(3,"local_bar"),T.Tb(),T.Tb()}}function St(e,t){if(1&e){var r=T.Vb();T.Ub(0,"mat-card-content"),T.Ub(1,"section",3),T.Ub(2,"h3",4),T.Cc(3,"Contract Status:"),T.Tb(),T.Ub(4,"mat-chip",5),T.Cc(5),T.Tb(),T.Ub(6,"span",6),T.Ub(7,"button",7),T.cc("click",(function(){return T.uc(r),T.gc().abortMe.emit()})),T.Ub(8,"mat-icon"),T.Cc(9,"flash_on"),T.Tb(),T.Tb(),T.Ub(10,"button",8),T.cc("click",(function(){T.uc(r);var e=T.gc();return e.remove.emit(e.contract.productKey)})),T.Ub(11,"mat-icon"),T.Cc(12,"delete_forever"),T.Tb(),T.Tb(),T.Tb(),T.Tb(),T.Ub(13,"section"),T.Ub(14,"mat-list",9),T.Ub(15,"mat-list-item"),T.Ub(16,"h3",10),T.Cc(17,"Product Key:"),T.Tb(),T.Ub(18,"span"),T.Cc(19),T.Tb(),T.Tb(),T.Ub(20,"mat-list-item"),T.Ub(21,"h3",10),T.Cc(22,"Product Description"),T.Tb(),T.Ub(23,"span"),T.Cc(24),T.Tb(),T.Tb(),T.Ub(25,"mat-list-item"),T.Ub(26,"h3",10),T.Cc(27,"Price"),T.Tb(),T.Ub(28,"span"),T.Cc(29),T.Tb(),T.Tb(),T.Ub(30,"mat-list-item"),T.Ub(31,"h3",10),T.Cc(32,"Balance"),T.Tb(),T.Ub(33,"span"),T.Cc(34),T.Tb(),T.Tb(),T.Ub(35,"mat-list-item"),T.Ub(36,"h3",10),T.Cc(37,"Seller Address"),T.Tb(),T.Ub(38,"span"),T.Cc(39),T.Tb(),T.Tb(),T.Ac(40,Ct,5,1,"mat-list-item",11),T.Ac(41,jt,5,1,"mat-list-item",11),T.Tb(),T.Tb(),T.Pb(42,"mat-divider"),T.Ub(43,"section",12),T.Ub(44,"h3",13),T.Cc(45,"Product Image"),T.Tb(),T.Pb(46,"img",14,15),T.Tb(),T.Pb(48,"mat-divider"),T.Ub(49,"section",16),T.Ac(50,Pt,9,2,"mat-form-field",17),T.Ac(51,Tt,2,1,"button",18),T.Ac(52,It,2,0,"button",19),T.Ac(53,kt,4,0,"button",20),T.Tb(),T.Pb(54,"mat-card-footer"),T.Tb()}if(2&e){var n=T.gc();T.Cb(4),T.lc("selected",!0)("color",n.statusColors[n.contract.state].color),T.Cb(1),T.Dc(n.enumToString(n.statusColors[n.contract.state].state)),T.Cb(2),T.lc("disabled",!n.canAbort),T.Cb(3),T.lc("disabled",!n.removeFromListing),T.Cb(9),T.Dc(n.contract.productKey),T.Cb(5),T.Dc(n.contract.description),T.Cb(5),T.Ec("",n.contract.price," ETH"),T.Cb(5),T.Ec("",n.contract.balance," ETH"),T.Cb(5),T.Dc(n.contract.sellerAddress),T.Cb(1),T.lc("ngIf",n.contract.buyerAddress),T.Cb(1),T.lc("ngIf",n.showCommission),T.Cb(9),T.lc("ngIf",n.canBuy),T.Cb(1),T.lc("ngIf",n.canBuy),T.Cb(1),T.lc("ngIf",n.canDelivery),T.Cb(1),T.lc("ngIf",n.canReleaseEscrow)}}function At(e,t){1&e&&T.Cc(0," ...Please wait for the contract to load.\n")}var xt,Ut=((xt=function(){function e(t){_classCallCheck(this,e),this.windowRef=t,this.remove=new T.o,this.abortMe=new T.o,this.buy=new T.o,this.delivery=new T.o,this.releaseEscrow=new T.o,this.receiveCommission=new T.o,this.statusColors=[{state:yt.Created,color:"accent"},{state:yt.Locked,color:"primary"},{state:yt.Canceled,color:void 0},{state:yt.ItemReceived,color:"accent"},{state:yt.SellerPaid,color:"primary"},{state:yt.OwnerPaid,color:"primary"},{state:yt.Completed,color:"warn"}],this.buyerConfirmPrice=new a.d("",[a.p.required,,a.p.pattern(/^\d+(\.\d{1,4})?$/)]),this.enumToString=function(e){return yt[e]}}return _createClass(e,[{key:"ngOnChanges",value:function(e){this.imageRef&&(this.imageRef.nativeElement.src=this.windowRef.window.URL.createObjectURL(this.image)),this.buyerConfirmPrice.reset()}},{key:"validatorError",get:function(){return this.buyerConfirmPrice.hasError("required")?"You must enter a value":this.buyerConfirmPrice.hasError("pattern")?"Not a valid format":""}},{key:"removeFromListing",get:function(){return this.contract.state===yt.Canceled&&this.contract.ownerAddress===this.account}},{key:"canAbort",get:function(){return this.contract.state===yt.Created&&this.contract.sellerAddress===this.account}},{key:"canBuy",get:function(){return this.contract.state===yt.Created&&!this.contract.buyerAddress&&this.contract.sellerAddress!==this.account}},{key:"canDelivery",get:function(){return this.contract.state===yt.Locked&&this.contract.buyerAddress===this.account}},{key:"showCommission",get:function(){return this.contract.ownerAddress===this.account||this.contract.sellerAddress===this.account}},{key:"canReleaseEscrow",get:function(){return(this.contract.state===yt.ItemReceived||this.contract.state===yt.OwnerPaid)&&this.contract.sellerAddress===this.account}},{key:"canReceiveCommission",get:function(){return(this.contract.state===yt.ItemReceived||this.contract.state===yt.SellerPaid)&&this.contract.ownerAddress===this.account}}]),e}()).\u0275fac=function(e){return new(e||xt)(T.Ob(le.c))},xt.\u0275cmp=T.Ib({type:xt,selectors:[["app-purchase-contract-detail"]],viewQuery:function(e,t){var r;1&e&&T.Gc(gt,!0),2&e&&T.rc(r=T.dc())&&(t.imageRef=r.first)},inputs:{contract:"contract",image:"image",account:"account"},outputs:{remove:"remove",abortMe:"abortMe",buy:"buy",delivery:"delivery",releaseEscrow:"releaseEscrow",receiveCommission:"receiveCommission"},features:[T.Ab],decls:5,vars:3,consts:[[4,"ngIf","ngIfThen","ngIfElse"],["selectedTmpl",""],["noSelectedTmpl",""],["fxLayout","row","fxLayoutAlign","start center"],["fxFlex","38","fxFlexOffset","2",1,"mat-h3"],["fxFlex","",3,"selected","color"],["fxFlex","20","fxFlexOffset","23"],["mat-icon-button","","color","warn","matTooltip","Abort contract by seller","matTooltipPosition","above",3,"disabled","click"],["mat-icon-button","","color","warn","matTooltip","Remove contract by owner","matTooltipPosition","above",3,"disabled","click"],["dense",""],[1,"mat-h3"],[4,"ngIf"],["fxLayout","row","fxLayoutAlign","start center",2,"padding","15px 0px"],["fxFlex","36","fxFlexOffset","2",1,"mat-h3"],["height","120px","width","120px"],["ipfsImage",""],["fxLayout","row wrap","fxLayoutAlign","space-between center",2,"margin-top","10px"],["appearance","outline",4,"ngIf"],["mat-raised-button","","color","warn",3,"disabled","click",4,"ngIf"],["mat-raised-button","","color","accent",3,"click",4,"ngIf"],["mat-raised-button","","color","primary","matTooltip","Seller click to receive escrow","matTooltipPosition","above",3,"click",4,"ngIf"],["appearance","outline"],["matInput","","required","",3,"formControl"],["matSuffix",""],["mat-raised-button","","color","warn",3,"disabled","click"],["mat-raised-button","","color","accent",3,"click"],["mat-raised-button","","color","primary","matTooltip","Seller click to receive escrow","matTooltipPosition","above",3,"click"]],template:function(e,t){if(1&e&&(T.Ac(0,Ot,1,0,"ng-container",0),T.Ac(1,St,55,16,"ng-template",null,1,T.Bc),T.Ac(3,At,1,0,"ng-template",null,2,T.Bc)),2&e){var r=T.sc(2),n=T.sc(4);T.lc("ngIf",t.contract)("ngIfThen",r)("ngIfElse",n)}},directives:[o.k,Pe.c,we.d,we.c,we.a,we.b,je.a,pe.b,xe.a,Se.a,it.a,it.c,st.a,Pe.d,Te.c,Te.g,Ie.b,a.b,a.o,a.k,a.e,Te.h,Te.f,Te.b],styles:["mat-list-item[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%] {\n        width: 240px;\n      }"]}),xt);function _t(e,t){if(1&e){var r=T.Vb();T.Ub(0,"app-purchase-contract-detail",1),T.cc("remove",(function(e){return T.uc(r),T.gc().removePurchaseContract(e)}))("abortMe",(function(){return T.uc(r),T.gc().abortPurchaseContract()}))("buy",(function(e){return T.uc(r),T.gc().confirmBuy(e)}))("delivery",(function(){return T.uc(r),T.gc().confirmDelivery()}))("releaseEscrow",(function(){return T.uc(r),T.gc().withdrawBySeller()}))("receiveCommission",(function(){return T.uc(r),T.gc().withdrawByOwner()})),T.Tb()}if(2&e){var n=t.ngIf;T.lc("contract",n.purchaseContract)("image",n.image)("account",n.account)}}var Bt,Et,$t,Rt,Ft,Lt,Kt,Mt,Dt,Nt,Ht=function(e,t,r){return{purchaseContract:e,image:t,account:r}},qt=((Et=function(){function e(t){_classCallCheck(this,e),this.store$=t,this.unsubscribe$=new vt.a}return _createClass(e,[{key:"ngOnInit",value:function(){var e=this;this.selectedPurchaseContract$=this.store$.pipe(Object(d.u)(ue),Object(de.a)((function(e){return!!e})),Object(f.a)((function(t){return e.store$.dispatch(c.loadPurchaseContract({address:t.contractAddress}))})),Object(mt.a)((function(){return e.store$.select(se)})),Object(de.a)((function(e){return!!e}))),this.image$=this.store$.pipe(Object(d.u)(se),Object(de.a)((function(e){return!!e})),Object(f.a)((function(t){return e.store$.dispatch(n.downloadImage({ipfsHash:t.ipfsHash}))})),Object(mt.a)((function(){return e.store$.select(re)})),Object(de.a)((function(e){return!!e}))),this.account$=this.store$.pipe(Object(d.u)(h.b))}},{key:"removePurchaseContract",value:function(e){this.store$.dispatch(c.removePurchaseContract({key:e}))}},{key:"abortPurchaseContract",value:function(){this.store$.dispatch(c.abortSelectedPurchaseContract())}},{key:"confirmBuy",value:function(e){this.store$.dispatch(c.confirmBuy({eth:e}))}},{key:"confirmDelivery",value:function(){this.store$.dispatch(c.confirmDelivery())}},{key:"withdrawBySeller",value:function(){this.store$.dispatch(c.releaseEscrow())}},{key:"withdrawByOwner",value:function(){this.store$.dispatch(c.withdrawByOwner())}},{key:"ngOnDestroy",value:function(){this.unsubscribe$.next(),this.unsubscribe$.complete()}}]),e}()).\u0275fac=function(e){return new(e||Et)(T.Ob(d.h))},Et.\u0275cmp=T.Ib({type:Et,selectors:[["app-view-purchase-contract"]],decls:4,vars:11,consts:[[3,"contract","image","account","remove","abortMe","buy","delivery","releaseEscrow","receiveCommission",4,"ngIf"],[3,"contract","image","account","remove","abortMe","buy","delivery","releaseEscrow","receiveCommission"]],template:function(e,t){1&e&&(T.Ac(0,_t,1,3,"app-purchase-contract-detail",0),T.hc(1,"async"),T.hc(2,"async"),T.hc(3,"async")),2&e&&T.lc("ngIf",T.qc(7,Ht,T.ic(1,1,t.selectedPurchaseContract$),T.ic(2,3,t.image$),T.ic(3,5,t.account$)))},directives:[o.k,Ut],pipes:[o.b],encapsulation:2,changeDetection:0}),Et),Vt=((Bt=function e(){_classCallCheck(this,e)}).\u0275mod=T.Mb({type:Bt}),Bt.\u0275inj=T.Lb({factory:function(e){return new(e||Bt)},imports:[[o.c]]}),Bt),Gt=r("Cfvw"),Yt=r("LRne"),Wt=r("cp0P"),Xt=r("5+tZ"),Qt=r("AytR"),zt=(($t=function(e){_inherits(r,e);var t=_createSuper(r);function r(e){return _classCallCheck(this,r),t.call(this,e)}return r}(b.providers.Web3Provider)).\u0275fac=function(e){return new(e||$t)(T.Yb(le.a))},$t.\u0275prov=T.Kb({token:$t,factory:$t.\u0275fac,providedIn:Vt}),$t),Jt=Qt.a.fleaMarketContractAddress,Zt=["event LogCreatePurchaseContract(address sender, bytes32 key, address contractAddress)","event LogRemovePurchaseContract(address sender, bytes32 key)","function createPurchaseContract(bytes32 key, string description, string ipfsImageHash, uint256 commissionRate) payable returns(bool createResult)","function getContractCount() view returns(uint contractCount)","function getContractKeyAtIndex(uint index) view returns(bytes32 key)","function getContractByKey(bytes32 key) view returns(address contractAddress)","function contractName() view returns(string contractName)","function removeContractByKey(bytes32 key) returns(bool result)"],er=((Kt=function(e){_inherits(r,e);var t=_createSuper(r);function r(e){return _classCallCheck(this,r),t.call(this,Jt,Zt,e.getSigner())}return r}(b.Contract)).\u0275fac=function(e){return new(e||Kt)(T.Yb(zt))},Kt.\u0275prov=T.Kb({token:Kt,factory:Kt.\u0275fac,providedIn:Vt}),Kt),tr=((Lt=function(){function e(t){var r=this;_classCallCheck(this,e),this.contractToken=t,this.widgetObservable=function(e){return Object(Gt.a)(r.contractToken.getContractKeyAtIndex(e)).pipe(Object(mt.a)((function(e){return Object(Gt.a)(r.contractToken.getContractByKey(e)).pipe(Object(be.a)((function(t){return{productKey:b.utils.parseBytes32String(e),contractAddress:t}})))})))}}return _createClass(e,[{key:"createPurchaseContract",value:function(e){var t=Math.floor(100*parseFloat(e.commission)),r=b.utils.formatBytes32String(e.productKey),n=b.utils.parseEther(e.etherValue),c=this.contractToken.createPurchaseContract(r,e.description,e.ipfsHash,t,{value:n});return Object(Gt.a)(c).pipe(Object(mt.a)((function(e){return console.log("Transaction",e),Object(Gt.a)(e.wait()).pipe(Object(f.a)((function(e){return console.log("TransactionReceipt: ",e)})),Object(be.a)((function(e){return e.events.pop()})),Object(be.a)((function(e){return e.args.contractAddress})),Object(f.a)((function(e){return console.log("address: ",e)})))})))}},{key:"getPurchaseContractList",value:function(){var e=this;return Object(Gt.a)(this.contractToken.getContractCount()).pipe(Object(be.a)((function(e){return e.toNumber()})),Object(f.a)((function(e){return console.log("contractCount: ",e)})),Object(mt.a)((function(t){if(0===t)return Object(Yt.a)([]);var r=Array.from(Array(t)).map((function(e,t){return t}));return Object(Yt.a)(r).pipe(Object(Xt.a)((function(t){return Object(Wt.a)(t.map(e.widgetObservable))})))})))}},{key:"getName",value:function(){return Object(Gt.a)(this.contractToken.contractName()).pipe(Object(be.a)((function(e){return e})))}},{key:"removePurchaseContract",value:function(e){var t=b.utils.formatBytes32String(e),r=this.contractToken.removeContractByKey(t);return Object(Gt.a)(r).pipe(Object(mt.a)((function(e){return console.log("removeContractByKey Transaction",e),Object(Gt.a)(e.wait()).pipe(Object(f.a)((function(e){return console.log("TransactionReceipt: ",e)})),Object(be.a)((function(e){return e.events.pop()})),Object(f.a)((function(e){return console.log("txEvent: ",e)})),Object(be.a)((function(e){return b.utils.parseBytes32String(e.args.key)})))})))}}]),e}()).\u0275fac=function(e){return new(e||Lt)(T.Yb(er))},Lt.\u0275prov=T.Kb({token:Lt,factory:Lt.\u0275fac,providedIn:Vt}),Lt),rr=((Ft=function(){function e(t){_classCallCheck(this,e),this.fleaSrv=t}return _createClass(e,[{key:"ngOnInit",value:function(){this.name$=this.fleaSrv.getName()}}]),e}()).\u0275fac=function(e){return new(e||Ft)(T.Ob(tr))},Ft.\u0275cmp=T.Ib({type:Ft,selectors:[["app-marketplace-home"]],decls:3,vars:0,consts:[[1,"mat-headline","text-center"]],template:function(e,t){1&e&&(T.Ub(0,"h1",0),T.Cc(1,"Inventory Management System"),T.Tb(),T.Pb(2,"router-outlet"))},directives:[s.k],encapsulation:2}),Ft),nr=((Rt=function e(){_classCallCheck(this,e)}).\u0275fac=function(e){return new(e||Rt)},Rt.\u0275cmp=T.Ib({type:Rt,selectors:[["app-product-detail-home"]],decls:2,vars:0,consts:[[1,"mat-subheading-2"]],template:function(e,t){1&e&&(T.Ub(0,"h3",0),T.Cc(1," To load a purchase contract details please select the corresponding item from the left panel"),T.Tb())},encapsulation:2}),Rt),cr=r("JIr8"),or=[{path:"",redirectTo:"products",pathMatch:"full"},{path:"products",component:rr,children:[{path:"",component:pt,canActivate:[(Mt=function(){function e(t){_classCallCheck(this,e),this.store=t}return _createClass(e,[{key:"canActivate",value:function(){return this.waitForProductsToLoad().pipe(Object(mt.a)((function(){return Object(Yt.a)(!0)})),Object(cr.a)((function(){return Object(Yt.a)(!1)})))}},{key:"waitForProductsToLoad",value:function(){var e=this;return this.store.pipe(Object(d.u)(ie),Object(f.a)((function(t){t||e.store.dispatch(c.loadProducts())})),Object(de.a)((function(e){return e})),Object(he.a)(1))}}]),e}(),Mt.\u0275fac=function(e){return new(e||Mt)(T.Yb(d.h))},Mt.\u0275prov=T.Kb({token:Mt,factory:Mt.\u0275fac,providedIn:Vt}),Mt)],children:[{path:":id",component:qt},{path:"",component:nr}]},{path:"make/new",component:tt,pathMatch:"full"}]}],ar=((Dt=function e(){_classCallCheck(this,e)}).\u0275mod=T.Mb({type:Dt}),Dt.\u0275inj=T.Lb({factory:function(e){return new(e||Dt)},imports:[[s.j.forChild(or)],s.j]}),Dt),ir=r("snw9"),sr=r("jJ/W"),ur=r("XqQ8"),lr=r("CO7z"),fr=r("JQUw"),br=r("tk/3"),dr=((Nt=function(){function e(t,r,c){var o=this;_classCallCheck(this,e),this.ipfsSrv=t,this.actions$=r,this.httpClient=c,this.uploadImage$=Object(ir.d)((function(){return o.actions$.pipe(Object(ir.e)(n.uploadImage),Object(be.a)((function(e){return e.file})),Object(ur.a)((function(e){return o.ipfsSrv.addFile(e).pipe(Object(f.a)((function(e){return console.log("IPFS file hash: "+e)})),Object(be.a)((function(e){return n.uploadImageSuccess({ipfsHash:e})})),Object(cr.a)((function(e){return Object(Yt.a)(o.handleError(e),n.uploadImageFail())})))})))})),this.downloadImage$=Object(ir.d)((function(){return o.actions$.pipe(Object(ir.e)(n.downloadImage),Object(be.a)((function(e){return e.ipfsHash})),Object(mt.a)((function(e){return o.ipfsSrv.getFile(e).pipe(Object(be.a)((function(e){return n.downloadImageSuccess({image:e})})),Object(cr.a)((function(e){return Object(Yt.a)(o.handleError(e),n.downloadImageError())})))})))})),this.downloadImageError$=Object(ir.d)((function(){return o.actions$.pipe(Object(ir.e)(n.downloadImageError),Object(mt.a)((function(){return o.httpClient.get("./assets/img/error-human.png",{responseType:"blob"}).pipe(Object(be.a)((function(e){return n.downloadImageSuccess({image:e})})),Object(cr.a)((function(e){return Object(Yt.a)(o.handleError(e))})))})))}))}return _createClass(e,[{key:"handleError",value:function(e){var t=Object(sr.serializeError)(e).message;return lr.a.errorMessage({errorMsg:t})}}]),e}()).\u0275fac=function(e){return new(e||Nt)(T.Yb(fr.a),T.Yb(ir.a),T.Yb(br.b))},Nt.\u0275prov=T.Kb({token:Nt,factory:Nt.\u0275fac}),Nt),hr=r("bOdf");function pr(e,t){return Object(hr.a)((function(){return e}),t)}var mr=r("7o/Q");function vr(e){return function(t){return t.lift(new Cr(e))}}var yr,gr,Or,Cr=function(){function e(t){_classCallCheck(this,e),this.value=t}return _createClass(e,[{key:"call",value:function(e,t){return t.subscribe(new jr(e,this.value))}}]),e}(),jr=function(e){_inherits(r,e);var t=_createSuper(r);function r(e,n){var c;return _classCallCheck(this,r),(c=t.call(this,e)).value=n,c}return _createClass(r,[{key:"_next",value:function(e){this.destination.next(this.value)}}]),r}(mr.a),wr=r("GyhO"),Pr=r("sKXY"),Tr=r("Zc21"),Ir=r("yCtX"),kr=r("DH7j"),Sr=r("Lhse"),Ar=r("zx2A"),xr=function(){function e(t){_classCallCheck(this,e),this.resultSelector=t}return _createClass(e,[{key:"call",value:function(e,t){return t.subscribe(new Ur(e,this.resultSelector))}}]),e}(),Ur=function(e){_inherits(r,e);var t=_createSuper(r);function r(e,n){var c;arguments.length>2&&void 0!==arguments[2]?arguments[2]:Object.create(null);return _classCallCheck(this,r),(c=t.call(this,e)).resultSelector=n,c.iterators=[],c.active=0,c.resultSelector="function"==typeof n?n:void 0,c}return _createClass(r,[{key:"_next",value:function(e){var t=this.iterators;Object(kr.a)(e)?t.push(new Br(e)):t.push("function"==typeof e[Sr.a]?new _r(e[Sr.a]()):new Er(this.destination,this,e))}},{key:"_complete",value:function(){var e=this.iterators,t=e.length;if(this.unsubscribe(),0!==t){this.active=t;for(var r=0;r<t;r++){var n=e[r];n.stillUnsubscribed?this.destination.add(n.subscribe()):this.active--}}else this.destination.complete()}},{key:"notifyInactive",value:function(){this.active--,0===this.active&&this.destination.complete()}},{key:"checkIterators",value:function(){for(var e=this.iterators,t=e.length,r=this.destination,n=0;n<t;n++){var c=e[n];if("function"==typeof c.hasValue&&!c.hasValue())return}for(var o=!1,a=[],i=0;i<t;i++){var s=e[i],u=s.next();if(s.hasCompleted()&&(o=!0),u.done)return void r.complete();a.push(u.value)}this.resultSelector?this._tryresultSelector(a):r.next(a),o&&r.complete()}},{key:"_tryresultSelector",value:function(e){var t;try{t=this.resultSelector.apply(this,e)}catch(r){return void this.destination.error(r)}this.destination.next(t)}}]),r}(mr.a),_r=function(){function e(t){_classCallCheck(this,e),this.iterator=t,this.nextResult=t.next()}return _createClass(e,[{key:"hasValue",value:function(){return!0}},{key:"next",value:function(){var e=this.nextResult;return this.nextResult=this.iterator.next(),e}},{key:"hasCompleted",value:function(){var e=this.nextResult;return Boolean(e&&e.done)}}]),e}(),Br=function(){function e(t){_classCallCheck(this,e),this.array=t,this.index=0,this.length=0,this.length=t.length}return _createClass(e,[{key:Sr.a,value:function(){return this}},{key:"next",value:function(e){var t=this.index++;return t<this.length?{value:this.array[t],done:!1}:{value:null,done:!0}}},{key:"hasValue",value:function(){return this.array.length>this.index}},{key:"hasCompleted",value:function(){return this.array.length===this.index}}]),e}(),Er=function(e){_inherits(r,e);var t=_createSuper(r);function r(e,n,c){var o;return _classCallCheck(this,r),(o=t.call(this,e)).parent=n,o.observable=c,o.stillUnsubscribed=!0,o.buffer=[],o.isComplete=!1,o}return _createClass(r,[{key:Sr.a,value:function(){return this}},{key:"next",value:function(){var e=this.buffer;return 0===e.length&&this.isComplete?{value:null,done:!0}:{value:e.shift(),done:!1}}},{key:"hasValue",value:function(){return this.buffer.length>0}},{key:"hasCompleted",value:function(){return 0===this.buffer.length&&this.isComplete}},{key:"notifyComplete",value:function(){this.buffer.length>0?(this.isComplete=!0,this.parent.notifyInactive()):this.destination.complete()}},{key:"notifyNext",value:function(e){this.buffer.push(e),this.parent.checkIterators()}},{key:"subscribe",value:function(){return Object(Ar.c)(this.observable,new Ar.a(this))}}]),r}(Ar.b),$r=((gr=function(){function e(t){_classCallCheck(this,e),this.provider=t,this.abi=["function key() view returns(bytes32 key)","function description() view returns(string description)","function seller() view returns(address sellerAddress)","function buyer() view returns(address buyerAddress)","function owner() view returns(address ownerAddress)","function price()  view returns(uint weiPrice)","function balanceOf() view returns(uint weiBalance)","function ipfsImageHash() view returns(string ipfsHash)","function state() view returns(uint8 state)","function commissionRate() view returns (uint commission)","event LogCanceledBySeller(address indexed sender, uint256 amount, bytes32 key)","function abortBySeller() returns (bool result)","event LogPurchaseConfirmed(address indexed sender, uint256 amount, bytes32 key)","function buyerPurchase() payable returns (bool result)","event LogReceivedByBuyer(address indexed sender, uint256 amount, bytes32 key)","function buyerConfirmReceived() returns (bool result)","event LogWithdrawBySeller(address indexed sender, uint256 amount, bytes32 key)","function withdrawBySeller() returns (bool result)","event LogWithdrawByOwner(address indexed sender, uint256 amount, bytes32 key)","function withdrawByOwner() returns (bool result)"]}return _createClass(e,[{key:"loadPurchaseContract",value:function(e){var t=new b.ethers.Contract(e,this.abi,this.provider.getSigner()),r=Object(Gt.a)(t.commissionRate()).pipe(Object(be.a)((function(e){return e.toNumber()})),Object(cr.a)((function(e){return Object(Yt.a)(null)})));return function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];var n=t[t.length-1];return"function"==typeof n&&t.pop(),Object(Ir.a)(t,void 0).lift(new xr(n))}(Object(Gt.a)(t.key()),Object(Gt.a)(t.seller()),Object(Gt.a)(t.buyer()),Object(Gt.a)(t.owner()),Object(Gt.a)(t.price()),Object(Gt.a)(t.balanceOf()),Object(Gt.a)(t.description()),Object(Gt.a)(t.ipfsImageHash()),Object(Gt.a)(t.state()),Object(Gt.a)(r)).pipe(Object(be.a)((function(t){var r=_slicedToArray(t,10),n=r[0],c=r[1],o=r[2],a=r[3],i=r[4],s=r[5],u=r[6],l=r[7],f=r[8],d=r[9];return console.log("key: ".concat(n,", weiPrice: ").concat(i,", state: ").concat(f,", commission: ").concat(d)),{productKey:b.utils.parseBytes32String(n),contractAddress:e,sellerAddress:c,buyerAddress:o===b.ethers.constants.AddressZero?null:o,ownerAddress:a,price:b.utils.formatEther(i),balance:b.utils.formatEther(s),description:u,ipfsHash:l,state:f,commission:d||null}})))}},{key:"abortPurchaseContract",value:function(e){var t=new b.ethers.Contract(e,this.abi,this.provider.getSigner()).abortBySeller();return Object(Gt.a)(t).pipe(Object(mt.a)((function(t){return console.log("abortBySeller Tx:",t),Object(Gt.a)(t.wait()).pipe(Object(f.a)((function(e){return console.log("txReceipt: ",e)})),Object(be.a)((function(e){return e.events.pop()})),Object(f.a)((function(e){return console.log("event: ",e.event)})),vr(e))})))}},{key:"confirmPurchase",value:function(e,t){var r=new b.ethers.Contract(e,this.abi,this.provider.getSigner()),n=b.utils.parseEther(t),c=r.buyerPurchase({value:n});return Object(Gt.a)(c).pipe(Object(mt.a)((function(t){return console.log("buyerConfirmPurchase Tx:",t),Object(Gt.a)(t.wait()).pipe(Object(f.a)((function(e){return console.log("txReceipt: ",e)})),Object(be.a)((function(e){return e.events.pop()})),Object(f.a)((function(e){return console.log("event: ",e.event)})),vr(e))})))}},{key:"confirmDelivery",value:function(e){var t=new b.ethers.Contract(e,this.abi,this.provider.getSigner()).buyerConfirmReceived();return Object(Gt.a)(t).pipe(Object(mt.a)((function(t){return console.log("buyerConfirmReceived Tx:",t),Object(Gt.a)(t.wait()).pipe(Object(f.a)((function(e){return console.log("txReceipt: ",e)})),Object(be.a)((function(e){return e.events.pop()})),Object(f.a)((function(e){return console.log("event: ",e.event)})),vr(e))})))}},{key:"withdrawBySeller",value:function(e){var t=new b.ethers.Contract(e,this.abi,this.provider.getSigner()).withdrawBySeller();return Object(Gt.a)(t).pipe(Object(mt.a)((function(e){return console.log("withdrawBySeller Tx:",e),Object(Gt.a)(e.wait()).pipe(Object(f.a)((function(e){return console.log("txReceipt: ",e)})),Object(be.a)((function(e){return e.events.pop()})),Object(f.a)((function(e){return console.log("event: ".concat(e.event,", sent by: ").concat(e.args.sender,", withdrawal amount: ").concat(e.args.amount))})),Object(be.a)((function(e){return b.ethers.utils.formatEther(e.args.amount)})))})))}},{key:"withdrawByOwner",value:function(e){var t=new b.ethers.Contract(e,this.abi,this.provider.getSigner()).withdrawByOwner();return Object(Gt.a)(t).pipe(Object(mt.a)((function(e){return console.log("withdrawByOwner Tx:",e),Object(Gt.a)(e.wait()).pipe(Object(f.a)((function(e){return console.log("txReceipt: ",e)})),Object(be.a)((function(e){return e.events.pop()})),Object(f.a)((function(e){return console.log("event: ".concat(e.event,", sent by: ").concat(e.args.sender,", withdrawal amount: ").concat(e.args.amount))})),Object(be.a)((function(e){return b.ethers.utils.formatEther(e.args.amount)})))})))}}]),e}()).\u0275fac=function(e){return new(e||gr)(T.Yb(zt))},gr.\u0275prov=T.Kb({token:gr,factory:gr.\u0275fac,providedIn:Vt}),gr),Rr=((yr=function(){function e(t,r,n,o,a,i){var s=this;_classCallCheck(this,e),this.store$=t,this.fleaSrv=r,this.purchaseSrv=n,this.actions$=o,this.router=a,this.dialog=i,this.createProduct$=Object(ir.d)((function(){return s.actions$.pipe(Object(ir.e)(c.createPurchaseContract),Object(be.a)((function(e){return e.payload})),Object(ur.a)((function(e){return s.fleaSrv.createPurchaseContract(e).pipe(Object(f.a)((function(e){return console.log("Contract address: ",e)})),Object(mt.a)((function(t){return[c.createPurchaseContractSuccess({product:{productKey:e.productKey,contractAddress:t}}),lr.e.getBalance()]})),Object(cr.a)((function(e){return Object(Yt.a)(s.handleError(e),lr.d.hide(),lr.e.getBalance())})))})))})),this.loadPurchaseContract$=Object(ir.d)((function(){return s.actions$.pipe(Object(ir.e)(c.loadPurchaseContract),Object(be.a)((function(e){return e.address})),Object(mt.a)((function(e){return s.purchaseSrv.loadPurchaseContract(e).pipe(Object(be.a)((function(e){return c.loadPurchaseContractSuccess({contract:e})})),Object(cr.a)((function(e){return Object(Yt.a)(s.handleError(e),lr.d.hide())})))})))})),this.loadProducts$=Object(ir.d)((function(){return s.actions$.pipe(Object(ir.e)(c.loadProducts),Object(mt.a)((function(){return s.fleaSrv.getPurchaseContractList().pipe(Object(f.a)((function(e){return console.log("purchase contracts:",e)})),Object(be.a)((function(e){return c.loadProductsSuccess({products:e})})),Object(cr.a)((function(e){return Object(Yt.a)(s.handleError(e),lr.d.hide())})))})))})),this.removeProduct$=Object(ir.d)((function(){return s.actions$.pipe(Object(ir.e)(c.removePurchaseContract),Object(be.a)((function(e){return e.key})),Object(mt.a)((function(e){var t=new l.e;return t.width="420px",t.disableClose=!0,t.autoFocus=!0,t.data={title:"Confirm Remove",content:"Are you sure to remove contract ".concat(e," from market?"),output:e},s.dialog.open(Tr.a,t).afterClosed()})),Object(de.a)((function(e){return!!e})),Object(ur.a)((function(e){return Object(wr.a)(Object(Yt.a)(lr.d.show()),s.fleaSrv.removePurchaseContract(e).pipe(Object(f.a)((function(e){return console.log("Contract has been removed: "+e)})),Object(hr.a)((function(e){return[c.removePurchaseContractSuccess({key:e}),lr.e.getBalance()]})),Object(cr.a)((function(e){return Object(Yt.a)(s.handleError(e),lr.d.hide(),lr.e.getBalance())}))),Object(Yt.a)(lr.d.hide()))})))})),this.abortContract$=Object(ir.d)((function(){return s.actions$.pipe(Object(ir.e)(c.abortSelectedPurchaseContract),Object(fe.a)(s.store$.pipe(Object(d.u)(se))),Object(mt.a)((function(e){var t=_slicedToArray(e,2),r=(t[0],t[1]),n=new l.e;return n.width="420px",n.disableClose=!0,n.autoFocus=!0,n.data={title:"Confirm Abort",content:"Are you sure you want to deactivate contract: ".concat(r.productKey,"?"),output:r.contractAddress},s.dialog.open(Tr.a,n).afterClosed()})),Object(de.a)((function(e){return!!e})),Object(ur.a)((function(e){return Object(wr.a)(Object(Yt.a)(lr.d.show()),s.purchaseSrv.abortPurchaseContract(e).pipe(Object(f.a)((function(e){return console.log("Successfully canceled contract: ".concat(e," "))})),pr([c.abortSelectedPurchaseContractSuccess(),lr.e.getBalance()]),Object(cr.a)((function(e){return Object(Yt.a)(s.handleError(e),lr.d.hide(),lr.e.getBalance())}))),Object(Yt.a)(lr.d.hide()))})))})),this.confirmBuy$=Object(ir.d)((function(){return s.actions$.pipe(Object(ir.e)(c.confirmBuy),Object(fe.a)(s.store$.pipe(Object(d.u)(se))),Object(mt.a)((function(e){var t=_slicedToArray(e,2),r=t[0],n=t[1],c=new l.e;return c.width="420px",c.disableClose=!0,c.autoFocus=!0,c.data={title:"Confirm Purchase",content:"Please confirm to deposit ".concat(r.eth," ETH into the contract: ").concat(n.productKey),output:{address:n.contractAddress,eth:r.eth}},s.dialog.open(Tr.a,c).afterClosed()})),Object(de.a)((function(e){return!!e})),Object(ur.a)((function(e){return Object(wr.a)(Object(Yt.a)(lr.d.show()),s.purchaseSrv.confirmPurchase(e.address,e.eth).pipe(Object(f.a)((function(e){return console.log("Purchase confirmed successfully for the contract: ".concat(e," "))})),pr([c.confirmBuySuccess(),lr.e.getBalance()]),Object(cr.a)((function(e){return Object(Yt.a)(s.handleError(e),lr.e.getBalance())}))),Object(Yt.a)(lr.d.hide()))})))})),this.confirmDelivery$=Object(ir.d)((function(){return s.actions$.pipe(Object(ir.e)(c.confirmDelivery),Object(fe.a)(s.store$.pipe(Object(d.u)(se))),Object(mt.a)((function(e){var t=_slicedToArray(e,2),r=(t[0],t[1]),n=new l.e;return n.width="420px",n.disableClose=!0,n.autoFocus=!0,n.data={title:"Confirm Delivery",content:"Are you sure you want to confirm that you received the purchase item "+r.description,output:r.contractAddress},s.dialog.open(Tr.a,n).afterClosed()})),Object(de.a)((function(e){return!!e})),Object(ur.a)((function(e){return Object(wr.a)(Object(Yt.a)(lr.d.show()),s.purchaseSrv.confirmDelivery(e).pipe(Object(f.a)((function(e){return console.log("Delivery confirmed successfully for the contract: ".concat(e," "))})),pr([c.confirmDeliverySuccess(),lr.e.getBalance()]),Object(cr.a)((function(e){return Object(Yt.a)(s.handleError(e),lr.e.getBalance())}))),Object(Yt.a)(lr.d.hide()))})))})),this.withdrawBySeller$=Object(ir.d)((function(){return s.actions$.pipe(Object(ir.e)(c.releaseEscrow),Object(fe.a)(s.store$.pipe(Object(d.u)(se))),Object(be.a)((function(e){var t=_slicedToArray(e,2);return t[0],t[1].contractAddress})),Object(ur.a)((function(e){return s.purchaseSrv.withdrawBySeller(e).pipe(Object(hr.a)((function(e){return[c.releaseEscrowSuccess({amount:e}),lr.e.getBalance()]})),Object(cr.a)((function(e){return Object(Yt.a)(s.handleError(e),lr.d.hide(),lr.e.getBalance())})))})))})),this.withdrawByOwner$=Object(ir.d)((function(){return s.actions$.pipe(Object(ir.e)(c.withdrawByOwner),Object(fe.a)(s.store$.pipe(Object(d.u)(se))),Object(be.a)((function(e){var t=_slicedToArray(e,2);return t[0],t[1].contractAddress})),Object(ur.a)((function(e){return s.purchaseSrv.withdrawByOwner(e).pipe(Object(hr.a)((function(e){return[c.withdrawByOwnerSuccess({amount:e}),lr.e.getBalance()]})),Object(cr.a)((function(e){return Object(Yt.a)(s.handleError(e),lr.d.hide(),lr.e.getBalance())})))})))})),this.removeProductRedirect$=Object(ir.d)((function(){return s.actions$.pipe(Object(ir.e)(c.removePurchaseContractSuccess),Object(f.a)((function(e){s.router.navigate(["/market-place"])})))}),{dispatch:!1}),this.reload$=Object(ir.d)((function(){return s.actions$.pipe(Object(ir.e)(c.abortSelectedPurchaseContractSuccess,c.confirmBuySuccess,c.confirmDeliverySuccess,c.releaseEscrowSuccess,c.withdrawByOwnerSuccess),Object(fe.a)(s.store$.pipe(Object(d.u)(se))),Object(f.a)((function(e){var t=_slicedToArray(e,2),r=(t[0],t[1]);return Object(u.b)(s,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.router.routeReuseStrategy.shouldReuseRoute=function(){return!1},this.router.navigate(["/market-place/products",r.productKey]);case 1:case"end":return e.stop()}}),e,this)})))})))}),{dispatch:!1}),this.showSpinner$=Object(ir.d)((function(){return s.actions$.pipe(Object(ir.e)(c.createPurchaseContract,c.loadProducts,c.loadPurchaseContract,c.releaseEscrow,c.withdrawByOwner),vr(lr.d.show()))})),this.hideSpinner$=Object(ir.d)((function(){return s.actions$.pipe(Object(ir.e)(c.createPurchaseContractSuccess,c.loadProductsSuccess,c.loadPurchaseContractSuccess,c.releaseEscrowSuccess,c.withdrawByOwnerSuccess),vr(lr.d.hide()))})),this.showSnackbarOnCreateContract$=Object(ir.d)((function(){return s.actions$.pipe(Object(ir.e)(c.createPurchaseContractSuccess),Object(be.a)((function(e){return lr.c.open({payload:{message:"New smart product contract has been created successfully: Address: "+e.product.contractAddress,color:Pr.a.Success}})})))})),this.showSnackbarOnReleaseEscrow$=Object(ir.d)((function(){return s.actions$.pipe(Object(ir.e)(c.releaseEscrowSuccess),Object(be.a)((function(e){return lr.c.open({payload:{message:"Fund in amount: ".concat(e.amount," ETH has been successfully release back to Seller"),color:Pr.a.Success}})})))})),this.showSnackbarOnReceiveCommission$=Object(ir.d)((function(){return s.actions$.pipe(Object(ir.e)(c.withdrawByOwnerSuccess),Object(be.a)((function(e){return lr.c.open({payload:{message:"Commission in amount: ".concat(e.amount," ETH has been successfully transferred to Owner"),color:Pr.a.Success}})})))})),this.showSnackbarOnSuccess$=Object(ir.d)((function(){return s.actions$.pipe(Object(ir.e)(c.abortSelectedPurchaseContractSuccess,c.confirmBuySuccess,c.confirmDeliverySuccess),Object(fe.a)(s.store$.pipe(Object(d.u)(se))),Object(be.a)((function(e){var t=_slicedToArray(e,2),r=t[0],n=t[1],c="";return"[PurchaseContract/Command] Abort Purchase Contract Success"===r.type?c="The request made by the seller to abort the contract '".concat(n.description,"' has been confirmed!"):"[PurchaseContract/Command] Confirm Buy Success"===r.type?c="Deposit fund made by the buyer for item '".concat(n.description,"' has been confirmed!"):"[PurchaseContract/Command] Confirm Product Delivery Success"===r.type&&(c="Receiving item '".concat(n.description,"' by the buyer has been confirmed!")),lr.c.open({payload:{message:c,color:Pr.a.Success}})})))}))}return _createClass(e,[{key:"handleError",value:function(e){var t=Object(sr.serializeError)(e).message;return lr.a.errorMessage({errorMsg:t})}}]),e}()).\u0275fac=function(e){return new(e||yr)(T.Yb(d.h),T.Yb(tr),T.Yb($r),T.Yb(ir.a),T.Yb(s.f),T.Yb(l.b))},yr.\u0275prov=T.Kb({token:yr,factory:yr.\u0275fac}),yr),Fr=[tt,pt,qt],Lr=[rr,Ce,ft,nr,Ut],Kr=((Or=function e(){_classCallCheck(this,e)}).\u0275mod=T.Mb({type:Or}),Or.\u0275inj=T.Lb({factory:function(e){return new(e||Or)},imports:[[o.c,i.c,i.b,a.n,Vt,ar,d.j.forFeature("purchaseContract",z),ir.b.forFeature([dr,Rr])]]}),Or)}}]);